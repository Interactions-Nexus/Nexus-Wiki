<!--
title: 增强合约
description: Nexus 麟社上的增强合约
published: true
date: 2022-12-11T14:58:31.856Z
tags: 
editor: ckeditor
dateCreated: 2022-12-11T10:36:02.051Z
-->

<h1>📃 增强合约</h1>
<p>Nexus 麟社虚拟机 (NVM) 是一种 <code><strong>state machine</strong></code>状态机，作为一个单一实体存在，由数百个连接的 Nexus 麟社节点维护。</p>
<p>Nexus 麟社软件堆栈的存在仅仅是为了保持这个特殊状态机的连续、不间断和不可变的运行； 它是所有 Nexus 麟社账户和增强合约所在的环境。 在链中的任何给定点，Nexus 麟社都有一个且只有一个 <code><strong>canonical</strong></code> 规范状态，而 NVM 麟社虚拟机定义了从一个区块到另一个区块计算新有效状态的规则。</p>
<p>尽管所有智能合约平台都是状态机，但对可扩展性以适应现实世界使用的痴迷最终造就了 NVM 的独特架构。 为了轻松区分更好的架构，必须将 Nexus 麟社上的合约命名为高级合约。 下面我们将解开架构。</p>
<h2>NVM 麟社虚拟机架构</h2>
<p>NVM 麟社虚拟机被设计为“64 位元”、“register based“ 基于寄存器； 选择此设计是因为它与 CPU 中央处理器的 64 位元匹配并模仿 CPU 中央处理器缓存寄存器。</p>
<p>与 EVM 相比，这种设计使 NVM 麟社虚拟机非常快，因为它是为当今的处理器设计的。 用数字表示，EVM 需要 170 万纳秒/指令，NVM 麟社虚拟机只需要 33 纳秒/指令。 由于 EVM 在 64 位元 CPU 上的 256 位长度及其过时的堆栈设计，EVM 处于一个巨大的劣势，因为它需要 4 个周期来完成一条指令。</p>
<p>NVM 麟社虚拟机有意设计为不图灵完备，这一决定也源于 Nexus 麟社是一个 <code><strong>Verification</strong></code> 验证引擎这一事实。 这种设计有一个巨大的优势，那就是免费的简单交易，而 EVM 需要 Gas 来控制由于糟糕的合约代码而导致的计算请求，这可能会使网络陷入停顿。 使用 NVM 麟社虚拟机设计，增强合约将具有可预测的费用，这些费用将在合约执行前就可以计算出来。</p>
<p>Nexus 麟社将有不同类型的合约，对于更高级别的 API，将提供模板，用户可以从下拉列表中选择。 对于高级用户，增强合同将使他们能够使用他们选择的领域特定语言的合约。 扩展合约将在以后提供。 有关详细信息，请参阅 &nbsp;<a href="https://nexus.io/roadmap">roadmap</a> 路线图。</p>
<h2>Operations &amp; Register Layers 操作和寄存器层</h2>
<p>简而言之，合约是对数据执行特定类型指令的请求，该指令会导致数据发生变化。 在 Nexus 麟社软件堆栈中，<code>Operations layer</code>&nbsp;操作层包含提供寄存器上下文的指令或操作，并定义更复杂的合约逻辑，<code>Register layer</code>&nbsp;寄存器层是数据层。 合约是一个包含以下内容的对象：寄存器预状态（从寄存器层向上传递的正在操作的寄存器），基元操作（每个合约只有一个基元操作）和一组条件（任何数量 条件操作）。</p>
<h3>Primitive Operations 基元操作</h3>
<p>操作层的当前迭代包含 16 个基元操作和 54 个条件操作和类型。 基元操作可以最好地描述为在寄存器上发生的操作，例如：WRITE、DEBIT、TRANSFER、APPEND 等。这些操作本身会导致寄存器以某种方式或形式更改其状态，包括从一个签名开始的移动 链到另一个。</p>
<h3>Conditional Contracts 条件合约</h3>
<p>条件合约是参与方之间的协议，概述了完成交易必须满足的一组要求。 它们是允许用户相互参与的基石，例如合约到期或物品交换。 更高级的非托管托管或仲裁形式也是可能的。 条件语句的复杂性没有限制，能够处理共同评估为真或假的条件组。 在条件返回 true 的情况下，这允许交易的接收者索取他们的资金或物品（取决于这是 TRANSFER 还是 DEBIT）。 如果接收方无法满足条件，在发送方设定的一段时间后，交易将可赎回。</p>
<blockquote>
  <p>在发布程序新更新时将提供更多信息。</p>
</blockquote>
<h2>API Layer 插件层</h2>
<p>API 插件层从合约（寄存器和操作层）外推。 开发人员可以轻松使用 API 插件，而不必编写 <code>smart-contract</code>&nbsp;智能合约。 尽管 API 插件层不是合约层，但它使用相同的合约层，可以通过领域特定语言 (DSL) 直接访问，以创建自定义合约。 这突出了软件堆栈的出色架构，因为相同的合约可以提供给无代码、Web 开发人员或集成到现有应用程序中，同时将它们从代码或区块链的复杂性中抽象出来。</p>
<h1>麟社上的合约</h1>
<p>Nexus 麟社设计了一种多管齐下的方法来解决 Nexus 麟社上的开发问题。 这让每个人都有机会构建和集成真正去中心化的解决方案。 下面给出了 Nexus 麟社上各种合约的详细信息</p>
<h2>Query DSL 查询领域特定语言</h2>
<p>Query DSL 查询领域特定语言是一种合约语言，增加了类似于 SQL 查询的功能，包括通配符搜索和逻辑运算符，使人们能够直接通过 API 插件搜索或过滤 Nexus 麟社上的任何数字资产或通证。 例如，可以搜索亚利桑那州的产权。 此功能为去中心化搜索引擎奠定了基础。</p>
<p>Query DSL 查询领域特定语言允许您搜索链的任何方面，您还可以过滤甚至操作查询的数据集。 支持的运算符有：min、max、mean、mode、sum、floor、array、sdev、median。 稍后将提供更多运营商。</p>
<p>Query DSL 查询领域特定语言基本上为区块链数据集提供了 SQL 功能。 运营商使其具有 Excel 功能等。 它对开发人员来说真的很强大。 它甚至可以搜索整个链：</p>
<pre><code class="language-plaintext">register/list/names where='object.name=l*' 
</code></pre>
<p>上面将显示每个以字母 l 开头的名称。 然后它可以通过过滤掉字段来运行运算符：</p>
<pre><code class="language-plaintext">register/list/names/name/array where='object.name=l*'
</code></pre>
<p>这将提供相同的数据集，但会提供一个以 “l” 开头的名称的 JSON 数组，不包括其他字段。 它还支持多个过滤器：</p>
<pre><code class="language-plaintext">register/list/names/name,owner where='object.name=l*'
</code></pre>
<p>这将响应名称和所有者字段，有点像您从名称中选择名称的 SQL 查询。 因此，它为开发人员提供了基于区块链功能的数据建模功能。</p>
<p>对整个链的全局搜索需要 1 到 2 秒。 运行得到的第一个注册命令：</p>
<p><code>[Completed in 1862.234494 ms]</code></p>
<p>有关更多信息，请查看以下链接：</p>
<ul>
  <li><a href="/en/tritium++/queries">Queries <i>A SQL like syntax query DSL</i></a></li>
  <li><a href="/en/tritium++/register">Register API <i>The Register API</i></a></li>
</ul>
<h2>Conditional Contracts 条件合约</h2>
<p>条件合约是二进制合约模板，用户将能够选择一个合约标准来发送。 这将引导每个命令集的合同标准和对象标准的动态分配。 标准化，我们可以分配新合约，这些合约将自动填充到标准列表中，而无需升级钱包。</p>
<p>这意味着我们将能够部署新的合约标准而无需发布新的钱包。 它将读取记录合同和对象标准的公共签名链。 这也将引导动态常量，例如费用，这样我们就可以调整共识关键值，而无需硬分叉或更新核心守护程序。</p>
<p>当用户使用 Nexus 麟社界面发送资金时，他们会得出现一个额外的下拉菜单，允许从标准模板合约列表中进行选择以发送。 这是朝着在现实世界中使用智能合约迈出的重要一步。</p>
<h2>Conditional Contracts 条件合约 DSL (未来)</h2>
<p>Conditional Contracts DSL, 一种用高级语言编写并编译成字节码的新标准。 专为将要开发新 API 插件或合约标准的用户而设计。 它允许使用英语将条件合约直接写入 API 插件，这是实现 Tritium 麟氚合约功能全部潜力的关键一步。 这种方法还使人们能够阅读或解释合约。 这将为开发人员揭示许多新功能。</p>
<p>到目前为止，我们一直将标准合约作为代码库中的嵌入式常量进行维护。 开发人员编写新合约的能力为使用 Nexus 麟社管理此状态的动态标准化提供了机会，类似于动态对象建模。</p>
<h2>Augmented Contracts 增强合约（路线图：2023-2025）</h2>
<p>对于需要完全创意控制的高级开发人员，我们开发了 Augmented Contacts 增强合约，它可以与所选的任何领域特定语言一起使用。 今天我们有条件合约、基元操作和寄存器。</p>
<p style="text-align:justify;">条件 VM（处理条件语句的虚拟机）将是 Augmented 增强的子集，例如在我的函数中我有一个 if 语句，它作为条件执行。 但是论据将允许编写复杂的代码。 例如，我有一个账户，我为 DEBIT 执行了一个操作重载函数，它可以为该账户的借记添加额外的要求，例如每个时间间隔的最大数额等。也可以添加另一个可以由另一个用户调用的公共方法，如果他们满足特定条件，就可以在我的账户上提取一笔款项，等等。 这将是我们解释器的完整实现，我们将拥有大多数语言（如 Java 和 C++）的功能。</p>
<p>增强合约是 Tritium 麟氚协议中可用的第二种合同。 这些类型的合约扩展了条件 VM（处理条件语句的虚拟机）以提供额外的好处，包括但不限于方法、函数、操作重载和封装。 增强合约增加了一层复杂性和处理，因此会产生更高的执行费用。 这将需要更多的链上处理，但总体上使我们的合约引擎更加强大。</p>
<p>增强合约的目标是提供复杂语言（如 C++）的相关功能，因此我们将支持多态性、运算符重载、函数、方法、公共、私有、受保护、唯一等。增强合约建立在现有的基于 VM 和 register-based 注册的架构。 更多的可编程语言和诸如地图、向量、函数等之类的东西将带有增强合约。</p>
<blockquote>
  <p>将随时提供更多的信息。</p>
</blockquote>
